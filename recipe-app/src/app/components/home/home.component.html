<div class="home-container">
  <!-- Header Section -->
  <div class="header-card">
    <h2 class="title">{{ 'nav_home' | translate }}</h2>
    
    <!-- Level Progress Bar -->
    <div class="progress-section">
      <div class="progress-header">
        <span class="progress-label">{{ 'level' | translate }} {{ level }}</span>
        <span class="progress-points">{{ points }} / {{ nextLevelPoints }} {{ 'points' | translate }}</span>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar-fill" [style.width.%]="levelProgress"></div>
      </div>
    </div>
  </div>

  <!-- Meal Plan Grid -->
  <div class="meal-plan-card">
    <h3 class="meal-plan-title">{{ 'home_meal_plan' | translate }}</h3>
    
    <!-- Grid Header (Days of Week) -->
    <div class="grid-container">
      <!-- Empty corner cell for meal type labels -->
      <div class="grid-header corner-cell"></div>
      
      <!-- Day Headers -->
      @for (day of daysOfWeek; track day) {
        <div class="grid-header day-header">
          {{ 'day_' + day | translate }}
        </div>
      }
      
      <!-- Grid Rows (Breakfast, Lunch, Dinner) -->
      @for (mealType of mealTypes; track mealType) {
        <!-- Meal Type Label -->
        <div class="grid-header meal-type-label">
          {{ 'meal_' + mealType | translate }}
        </div>
        
        <!-- Meal Cells for each day -->
        @for (day of daysOfWeek; track day) {
          @let meal = getMeal(day, mealType);
          
          <div 
            class="meal-cell"
            #dropZone
            [class.has-meal]="meal"
            (dragover)="onDragOver($event)"
            (dragenter)="onDragEnter($event, dropZone)"
            (dragleave)="onDragLeave($event, dropZone)"
            (drop)="onDrop($event, day, mealType, dropZone)">
            
            @if (meal) {
              <!-- Meal Card -->
              <div class="meal-card">
                <button class="remove-btn" (click)="removeMeal($event, day, mealType)">√ó</button>
                
                <div class="meal-name">{{ meal.recipeName }}</div>
                
                <!-- Servings Control -->
                <div class="servings-control">
                  <button class="servings-btn" (click)="decrementServings($event, day, mealType)">-</button>
                  <span class="servings-count">{{ meal.servings }} {{ 'meal_servings' | translate }}</span>
                  <button class="servings-btn" (click)="incrementServings($event, day, mealType)">+</button>
                </div>
              </div>
            } @else {
              <!-- Empty Drop Zone -->
              <div class="empty-zone" (click)="openAddModal(day, mealType)">
                <div class="drop-text">{{ 'meal_drop_here' | translate }}</div>
                <button class="add-btn">+</button>
              </div>
            }
          </div>
        }
      }
    </div>
  </div>

  <!-- Recipe Selection Modal -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3 class="modal-title">{{ 'meal_select_recipe' | translate }}</h3>
          <button class="modal-close" (click)="closeModal()">√ó</button>
        </div>
        
        <div class="modal-body">
          <!-- Search Bar -->
          <input 
            type="text" 
            class="search-input"
            [placeholder]="'meal_search_placeholder' | translate"
            [(ngModel)]="searchQuery"
            (ngModelChange)="searchQuery.set($event)">
          
          <!-- Recipe List -->
          <div class="recipe-list">
            @if (filteredRecipes.length > 0) {
              @for (recipe of filteredRecipes; track recipe.title) {
                <div class="recipe-item" (click)="selectRecipeFromModal(recipe)">
                  <div class="recipe-info">
                    <div class="recipe-title">{{ recipe.title }}</div>
                    <div class="recipe-meta">
                      <span class="recipe-time">‚è± {{ recipe.prepTime }}</span>
                      <span class="recipe-servings">üë• {{ recipe.servings }} {{ 'meal_servings' | translate }}</span>
                    </div>
                  </div>
                  <div class="recipe-arrow">‚Üí</div>
                </div>
              }
            } @else {
              <div class="no-recipes">
                <p>{{ 'meal_no_recipes' | translate }}</p>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>
