<div class="home-container">
  <!-- Header Section -->
  <div class="header-card">
    <h2 class="title">{{ 'nav_home' | translate }}</h2>
    
    <!-- Level Progress Bar -->
    <div class="progress-section">
      <div class="progress-header">
        <span class="progress-label">{{ 'level' | translate }} {{ level }}</span>
        <span class="progress-points">{{ points }} / {{ nextLevelPoints }} {{ 'points' | translate }}</span>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar-fill" [style.width.%]="levelProgress"></div>
      </div>
    </div>
  </div>

  <!-- Main Layout: Weekly Plan + Calendar -->
  <div class="main-layout">
    <!-- Weekly Meal Plan -->
    <div class="meal-plan-card">
      <div class="meal-plan-header">
        <h3 class="meal-plan-title">{{ 'home_meal_plan' | translate }}</h3>
        
        @if (hasMealsInPlan()) {
          <button class="generate-list-btn" (click)="requestGenerateShoppingList()">
            <span class="btn-icon">üõí</span>
            <span>{{ 'generate_shopping_list' | translate }}</span>
          </button>
        }
      </div>
      
      <!-- Weekly Days Grid -->
      <div class="week-grid">
        @for (day of daysOfWeek; track day) {
          <div class="day-card">
            <!-- Day Header -->
            <div class="day-header">
              <div class="day-name">{{ 'day_' + day | translate }}</div>
              <div class="day-meals-count">{{ getMealsForDay(day).length }} {{ getMealsForDay(day).length === 1 ? 'meal' : 'meals' }}</div>
            </div>
            
            <!-- Meals List for the day -->
            <div class="meals-list">
              @if (getMealsForDay(day).length > 0) {
                @for (meal of getMealsForDay(day); track meal) {
                  <div class="meal-item">
                    <span class="meal-name">{{ meal }}</span>
                    <button class="remove-meal-btn" (click)="removeMeal($event, day, meal)">‚úï</button>
                  </div>
                }
              } @else {
                <div class="empty-day">
                  <div class="empty-icon">üì≠</div>
                  <div class="empty-text">{{ 'no_meals_planned' | translate }}</div>
                </div>
              }
            </div>
            
            <!-- Add Meal Button -->
            <button class="add-meal-btn" (click)="openAddModal(day)">
              <span class="plus-icon">+</span> {{ 'add_meal' | translate }}
            </button>
          </div>
        }
      </div>
    </div>

    <!-- Month Calendar -->
    <div class="calendar-card">
      <div class="calendar-header">
        <h3 class="calendar-title">{{ getCurrentMonth() }}</h3>
      </div>
      
      <!-- Calendar Grid -->
      <div class="calendar-container">
        <!-- Weekday Headers -->
        <div class="calendar-weekdays">
          <div class="weekday-header">Mon</div>
          <div class="weekday-header">Tue</div>
          <div class="weekday-header">Wed</div>
          <div class="weekday-header">Thu</div>
          <div class="weekday-header">Fri</div>
          <div class="weekday-header">Sat</div>
          <div class="weekday-header">Sun</div>
        </div>
        
        <!-- Calendar Days -->
        <div class="calendar-grid">
          @for (day of getCalendarDays(); track day.date) {
            <div 
              class="calendar-day"
              [class.other-month]="!day.isCurrentMonth"
              [class.today]="day.isToday"
              [class.has-meals]="hasMealsOnDate(day.date)">
              <div class="date-number">{{ day.date }}</div>
              @if (day.isCurrentMonth && hasMealsOnDate(day.date)) {
                <div class="meal-dot">‚óè</div>
              }
            </div>
          }
        </div>
      </div>
      
      <!-- Legend -->
      <div class="calendar-legend">
        <div class="legend-item">
          <span class="legend-dot today">‚óè</span>
          <span class="legend-text">Today</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot has-meals">‚óè</span>
          <span class="legend-text">Has meals</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Recipe Selection Modal -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3 class="modal-title">{{ 'meal_select_recipe' | translate }}</h3>
          <button class="modal-close" (click)="closeModal()">√ó</button>
        </div>
        
        <div class="modal-body">
          <!-- Search Bar -->
          <input 
            type="text" 
            class="search-input"
            [placeholder]="'meal_search_placeholder' | translate"
            [(ngModel)]="searchQuery"
            (ngModelChange)="searchQuery.set($event)">
          
          <!-- Recipe List -->
          <div class="recipe-list">
            @if (filteredRecipes.length > 0) {
              @for (recipe of filteredRecipes; track recipe.title) {
                <div class="recipe-item" (click)="selectRecipeFromModal(recipe)">
                  <div class="recipe-info">
                    <div class="recipe-title">{{ recipe.title }}</div>
                    <div class="recipe-meta">
                      <span class="recipe-time">‚è± {{ recipe.prepTime }}</span>
                      <span class="recipe-servings">üë• {{ recipe.servings }} {{ 'meal_servings' | translate }}</span>
                    </div>
                  </div>
                  <div class="recipe-arrow">‚Üí</div>
                </div>
              }
            } @else {
              <div class="no-recipes">
                <p>{{ 'meal_no_recipes' | translate }}</p>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>
